<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Boot 在线调试工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen" x-data="debugApp()" x-init="init()">
    <!-- 头部导航 -->
    <nav class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-bug text-2xl text-blue-600 mr-3"></i>
                    <h1 class="text-xl font-semibold text-gray-900">Spring Boot 在线调试工具</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                              :class="status.totalRuleCount > 0 ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'">
                            <i class="fas fa-circle mr-1" :class="status.totalRuleCount > 0 ? 'text-green-400' : 'text-gray-400'"></i>
                            <span x-text="status.totalRuleCount"></span> 个调试规则
                        </span>
                    </div>
                    <button @click="refreshStatus()" 
                            class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-sync-alt" :class="{ 'animate-spin': loading }"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- 状态面板 -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-crosshairs text-2xl text-blue-500"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">精确方法</p>
                        <p class="text-2xl font-semibold text-gray-900" x-text="status.exactMethodCount"></p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-search text-2xl text-green-500"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">模式匹配</p>
                        <p class="text-2xl font-semibold text-gray-900" x-text="status.patternCount"></p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-cube text-2xl text-purple-500"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">类级别</p>
                        <p class="text-2xl font-semibold text-gray-900" x-text="status.classCount"></p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-box text-2xl text-orange-500"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">包级别</p>
                        <p class="text-2xl font-semibold text-gray-900" x-text="status.packageCount"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作面板 -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">调试规则管理</h2>
            </div>
            <div class="p-6">
                <!-- Tab 导航 -->
                <div class="border-b border-gray-200 mb-4">
                    <nav class="-mb-px flex space-x-8">
                        <button @click="activeTab = 'method'"
                                :class="activeTab === 'method' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                            <i class="fas fa-crosshairs mr-2"></i>精确方法
                        </button>
                        <button @click="activeTab = 'class'"
                                :class="activeTab === 'class' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                            <i class="fas fa-cube mr-2"></i>类级别
                        </button>
                        <button @click="activeTab = 'package'"
                                :class="activeTab === 'package' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                            <i class="fas fa-box mr-2"></i>包级别
                        </button>
                        <button @click="activeTab = 'pattern'"
                                :class="activeTab === 'pattern' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                            <i class="fas fa-search mr-2"></i>模式匹配
                        </button>
                        <button @click="activeTab = 'rules'"
                                :class="activeTab === 'rules' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                            <i class="fas fa-list mr-2"></i>规则列表
                        </button>
                    </nav>
                </div>

                <!-- 方法调试 -->
                <div x-show="activeTab === 'method'" x-cloak class="fade-in">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 添加方法调试 -->
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">添加方法调试</h3>
                            <div class="space-y-3">
                                <input type="text" 
                                       x-model="methodInput"
                                       @keyup.enter="addMethodDebug()"
                                       placeholder="com.example.service.UserService.getUserById"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <div class="flex space-x-2">
                                    <button @click="addMethodDebug()"
                                            :disabled="!methodInput.trim() || loading"
                                            class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                        <i class="fas fa-plus mr-2"></i>添加调试
                                    </button>
                                    <button @click="showClassBrowser = true"
                                            class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-search mr-2"></i>浏览
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 快捷操作 -->
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">快捷操作</h3>
                            <div class="space-y-2">
                                <button @click="setGlobalDebug(true)"
                                        :disabled="loading || status.globalEnabled"
                                        class="w-full bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                    <i class="fas fa-globe mr-2"></i>启用全局调试 (谨慎使用)
                                </button>
                                <button @click="setGlobalDebug(false)"
                                        :disabled="loading || !status.globalEnabled"
                                        class="w-full bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                    <i class="fas fa-stop mr-2"></i>禁用全局调试
                                </button>
                                <button @click="clearAllRules()"
                                        :disabled="loading || status.totalRuleCount === 0"
                                        class="w-full bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                    <i class="fas fa-trash mr-2"></i>清除所有规则
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 类调试 -->
                <div x-show="activeTab === 'class'" x-cloak class="fade-in">
                    <div class="max-w-md">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">添加类调试</h3>
                        <div class="space-y-3">
                            <input type="text" 
                                   x-model="classInput"
                                   @keyup.enter="addClassDebug()"
                                   placeholder="com.example.service.UserService"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button @click="addClassDebug()"
                                    :disabled="!classInput.trim() || loading"
                                    class="w-full bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加类调试
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 包调试 -->
                <div x-show="activeTab === 'package'" x-cloak class="fade-in">
                    <div class="max-w-md">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">添加包调试</h3>
                        <div class="space-y-3">
                            <input type="text" 
                                   x-model="packageInput"
                                   @keyup.enter="addPackageDebug()"
                                   placeholder="com.example.service"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button @click="addPackageDebug()"
                                    :disabled="!packageInput.trim() || loading"
                                    class="w-full bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加包调试
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 模式匹配 -->
                <div x-show="activeTab === 'pattern'" x-cloak class="fade-in">
                    <div class="max-w-md">
                        <h3 class="text-sm font-medium text-gray-900 mb-3">添加模式匹配调试</h3>
                        <div class="space-y-3">
                            <input type="text" 
                                   x-model="patternInput"
                                   @keyup.enter="addPatternDebug()"
                                   placeholder=".*\.service\..*\.get.*"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-500">支持正则表达式，例如: .*Service.*\.get.*</p>
                            <button @click="addPatternDebug()"
                                    :disabled="!patternInput.trim() || loading"
                                    class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加模式调试
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 规则列表 -->
                <div x-show="activeTab === 'rules'" x-cloak class="fade-in">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-sm font-medium text-gray-900">当前调试规则</h3>
                            <button @click="refreshRules()" 
                                    :disabled="loading"
                                    class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200 disabled:opacity-50 transition-colors">
                                <i class="fas fa-sync-alt mr-1" :class="{ 'animate-spin': loading }"></i>刷新
                            </button>
                        </div>

                        <!-- 规则列表 -->
                        <div x-show="debugRules.length === 0" class="text-center py-8 text-gray-500">
                            <i class="fas fa-inbox text-3xl mb-3"></i>
                            <p>暂无调试规则</p>
                            <p class="text-sm mt-1">请通过上面的标签页添加调试规则</p>
                        </div>

                        <div x-show="debugRules.length > 0" class="space-y-2">
                            <template x-for="rule in debugRules" :key="rule.type + '-' + rule.target">
                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-1">
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mr-3"
                                                  :class="{
                                                      'bg-blue-100 text-blue-800': rule.type === 'method',
                                                      'bg-purple-100 text-purple-800': rule.type === 'class',
                                                      'bg-orange-100 text-orange-800': rule.type === 'package',
                                                      'bg-green-100 text-green-800': rule.type === 'pattern'
                                                  }">
                                                <i class="fas fa-circle mr-1 text-xs"
                                                   :class="{
                                                       'fa-crosshairs': rule.type === 'method',
                                                       'fa-cube': rule.type === 'class', 
                                                       'fa-box': rule.type === 'package',
                                                       'fa-search': rule.type === 'pattern'
                                                   }"></i>
                                                <span x-text="rule.type === 'method' ? '方法' : rule.type === 'class' ? '类' : rule.type === 'package' ? '包' : '模式'"></span>
                                            </span>
                                            <span class="text-sm font-medium text-gray-900" x-text="rule.target"></span>
                                        </div>
                                        <p class="text-xs text-gray-600" x-text="rule.description"></p>
                                    </div>
                                    <div class="flex items-center space-x-2 ml-4">
                                        <button @click="removeRule(rule)"
                                                :disabled="loading"
                                                class="text-red-600 hover:text-red-800 disabled:opacity-50 p-2 rounded-full hover:bg-red-50 transition-colors"
                                                title="删除规则">
                                            <i class="fas fa-trash text-sm"></i>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- 批量操作 -->
                        <div x-show="debugRules.length > 0" class="pt-4 border-t">
                            <button @click="clearAllRules()"
                                    :disabled="loading"
                                    class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                                <i class="fas fa-trash-alt mr-2"></i>清除所有规则
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 消息提示 -->
        <div x-show="message" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform translate-y-2"
             class="fixed bottom-4 right-4 max-w-sm w-full">
            <div :class="messageType === 'success' ? 'bg-green-500' : 'bg-red-500'" 
                 class="text-white px-6 py-4 rounded-lg shadow-lg">
                <div class="flex items-center">
                    <i :class="messageType === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle'" 
                       class="mr-3"></i>
                    <span x-text="message"></span>
                    <button @click="message = ''" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 类浏览器模态框 -->
    <div x-show="showClassBrowser" 
         x-cloak
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
         @click.self="showClassBrowser = false">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">选择类和方法</h3>
                    <button @click="showClassBrowser = false" 
                            class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-96">
                    <!-- 类列表 -->
                    <div class="border rounded-lg">
                        <div class="p-3 border-b bg-gray-50">
                            <h4 class="font-medium text-sm text-gray-900">类列表</h4>
                            <input type="text" 
                                   x-model="classSearch"
                                   @input="searchClasses()"
                                   placeholder="搜索类名..."
                                   class="mt-2 w-full px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                        </div>
                        <div class="h-80 overflow-y-auto">
                            <template x-for="className in filteredClasses" :key="className">
                                <div @click="selectClass(className)"
                                     :class="selectedClass === className ? 'bg-blue-50 border-blue-200' : 'border-transparent hover:bg-gray-50'"
                                     class="p-3 border-l-4 cursor-pointer text-sm">
                                    <span x-text="className" class="text-gray-900"></span>
                                </div>
                            </template>
                            <div x-show="filteredClasses.length === 0" class="p-4 text-center text-gray-500 text-sm">
                                没有找到匹配的类
                            </div>
                        </div>
                    </div>

                    <!-- 方法列表 -->
                    <div class="border rounded-lg">
                        <div class="p-3 border-b bg-gray-50">
                            <h4 class="font-medium text-sm text-gray-900">方法列表</h4>
                            <p x-show="selectedClass" class="text-xs text-gray-600 mt-1" x-text="selectedClass"></p>
                        </div>
                        <div class="h-80 overflow-y-auto">
                            <template x-for="method in classMethods" :key="method.fullName">
                                <div @click="selectMethod(method)"
                                     class="p-3 border-b border-gray-100 cursor-pointer hover:bg-blue-50">
                                    <div class="text-sm font-medium text-gray-900" x-text="method.name"></div>
                                    <div class="text-xs text-gray-600 mt-1" x-text="method.signature"></div>
                                </div>
                            </template>
                            <div x-show="!selectedClass" class="p-4 text-center text-gray-500 text-sm">
                                请先选择一个类
                            </div>
                            <div x-show="selectedClass && classMethods.length === 0" class="p-4 text-center text-gray-500 text-sm">
                                该类没有可调试的方法
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function debugApp() {
            return {
                // 状态数据
                status: {
                    exactMethodCount: 0,
                    patternCount: 0,
                    classCount: 0,
                    packageCount: 0,
                    globalEnabled: false,
                    totalRuleCount: 0
                },
                
                // 界面状态
                activeTab: 'method',
                loading: false,
                message: '',
                messageType: 'success',
                
                // 输入字段
                methodInput: '',
                classInput: '',
                packageInput: '',
                patternInput: '',
                
                // 类浏览器
                showClassBrowser: false,
                classSearch: '',
                filteredClasses: [],
                selectedClass: '',
                classMethods: [],
                
                // 调试规则列表
                debugRules: [],
                
                // 初始化
                async init() {
                    await this.refreshStatus();
                    await this.refreshRules();
                },
                
                // 刷新状态
                async refreshStatus() {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/status');
                        const result = await response.json();
                        if (result.success) {
                            this.status = result.data;
                        }
                    } catch (error) {
                        this.showMessage('获取状态失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 添加方法调试
                async addMethodDebug() {
                    if (!this.methodInput.trim()) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/method', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target: this.methodInput.trim() })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('方法调试规则添加成功', 'success');
                            this.methodInput = '';
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('添加失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('添加失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 添加类调试
                async addClassDebug() {
                    if (!this.classInput.trim()) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/class', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target: this.classInput.trim() })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('类调试规则添加成功', 'success');
                            this.classInput = '';
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('添加失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('添加失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 添加包调试
                async addPackageDebug() {
                    if (!this.packageInput.trim()) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/package', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target: this.packageInput.trim() })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('包调试规则添加成功', 'success');
                            this.packageInput = '';
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('添加失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('添加失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 添加模式调试
                async addPatternDebug() {
                    if (!this.patternInput.trim()) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/pattern', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target: this.patternInput.trim() })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('模式调试规则添加成功', 'success');
                            this.patternInput = '';
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('添加失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('添加失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 设置全局调试
                async setGlobalDebug(enabled) {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/global', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ enabled })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage(enabled ? '全局调试已启用' : '全局调试已禁用', 'success');
                            await this.refreshStatus();
                        } else {
                            this.showMessage('操作失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('操作失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 清除所有规则
                async clearAllRules() {
                    if (!confirm('确定要清除所有调试规则吗？')) return;
                    
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/clear', {
                            method: 'POST'
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('所有调试规则已清除', 'success');
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('清除失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('清除失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 搜索类
                async searchClasses() {
                    // TODO: 实现类搜索功能
                    this.filteredClasses = [
                        'com.example.onlinedebug.demo.DemoService'
                    ].filter(className => 
                        className.toLowerCase().includes(this.classSearch.toLowerCase())
                    );
                },
                
                // 选择类
                async selectClass(className) {
                    this.selectedClass = className;
                    // TODO: 加载类的方法列表
                    this.classMethods = [
                        { name: 'getUserById', fullName: className + '.getUserById', signature: 'User getUserById(Long id)' },
                        { name: 'getAllUsers', fullName: className + '.getAllUsers', signature: 'List<User> getAllUsers()' }
                    ];
                },
                
                // 选择方法
                selectMethod(method) {
                    this.methodInput = method.fullName;
                    this.showClassBrowser = false;
                },
                
                // 刷新规则列表
                async refreshRules() {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/debug/rules');
                        const result = await response.json();
                        if (result.success) {
                            this.debugRules = result.data.allRules || [];
                        }
                    } catch (error) {
                        this.showMessage('获取规则列表失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 删除单个规则
                async removeRule(rule) {
                    if (!confirm('确定要删除这条调试规则吗？')) return;
                    
                    this.loading = true;
                    try {
                        let endpoint;
                        switch (rule.type) {
                            case 'method':
                                endpoint = '/api/debug/method';
                                break;
                            case 'class':
                                endpoint = '/api/debug/class';
                                break;
                            case 'package':
                                endpoint = '/api/debug/package';
                                break;
                            case 'pattern':
                                endpoint = '/api/debug/pattern';
                                break;
                            default:
                                throw new Error('未知的规则类型: ' + rule.type);
                        }
                        
                        const response = await fetch(endpoint, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ target: rule.target })
                        });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('调试规则删除成功', 'success');
                            await this.refreshStatus();
                            await this.refreshRules();
                        } else {
                            this.showMessage('删除失败: ' + result.message, 'error');
                        }
                    } catch (error) {
                        this.showMessage('删除失败: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 显示消息
                showMessage(msg, type = 'success') {
                    this.message = msg;
                    this.messageType = type;
                    setTimeout(() => {
                        this.message = '';
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>